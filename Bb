yypackage com.example.xmlparser.service;

import com.example.xmlparser.model.*;
import jakarta.xml.bind.JAXBContext;
import jakarta.xml.bind.Unmarshaller;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

@Service
public class XmlToCsvService {

    @Value("${xml.file.path}")
    private String xmlFilePath;

    @Value("${csv.output.path}")
    private String csvOutputPath;

    public void convertXmlToCsv() throws Exception {
        SecLendCommissRep secLendCommissRep = loadXmlDocument();
        List<String> headers = getHeaders();

        try (FileWriter writer = new FileWriter(csvOutputPath)) {
            // Write headers
            writer.write(String.join("|", headers) + "\n");

            // Write data
            SecLendCommissSection section = secLendCommissRep.getSecLendCommissRepInfo().getSecLendCommissSection();
            SecInstr secInstr = section.getSecInstr();
            
            for (SecLendCommissDetl detl : section.getSecLendCommissDetl()) {
                List<String> rowData = new ArrayList<>();
                
                // Add common data
                rowData.add(secLendCommissRep.getTmstmp()); // businessDate
                rowData.add(detl.getLoanRef()); // tradeTicket
                rowData.add(""); // tradeTag (empty as not in XML)
                rowData.add(detl.getExtRef()); // external TradeID
                rowData.add(detl.getLoanTyp()); // activityType
                rowData.add(detl.getLenBorrInd()); // buyOrSell
                rowData.add(detl.getLoanOpngDt()); // tradeDate
                rowData.add(detl.getLoanClsgDt()); // valueDate
                rowData.add(secInstr.getIsinCd()); // ISIN
                rowData.add(secInstr.getInstrTyp()); // instrument Type
                rowData.add(secInstr.getSecNm()); // securityName
                rowData.add(String.valueOf(detl.getLoanQty().getValue())); // nominalAmount
                rowData.add(String.valueOf(detl.getLoanVal().getValue())); // netConsiderationoutstanding
                rowData.add(detl.getLoanVal().getIsoCurrCd()); // currency
                rowData.add(String.valueOf(detl.getBondPrcAccrInt())); // bondAccural Interest
                rowData.add(detl.getXchgRate().getFrstIsoCurrCd()); // firstCurrency
                rowData.add(detl.getXchgRate().getRecpIsoCurrCd()); // SecondCurrency
                rowData.add(String.valueOf(detl.getXchgRate().getValue())); // exchangeRate
                rowData.add(String.valueOf(detl.getFeeRate())); // feeRate
                rowData.add(String.valueOf(detl.getDivCoupReq())); // dividendCoupon
                rowData.add(String.valueOf(detl.getHdlgFeeAmnt().getValue())); // handling Fee
                rowData.add(detl.getHdlgFeeAmnt().getIsoCurrCd()); // handlingCurrency
                rowData.add(String.valueOf(detl.getCurntCommissAmnt().getValue())); // commissionAmount
                rowData.add(detl.getCurntCommissAmnt().getIsoCurrCd()); // commissionCurrency
                rowData.add(String.valueOf(detl.getAccrCommissAmnt().getValue())); // accuralCommissionAmount
                rowData.add(detl.getAccrCommissAmnt().getIsoCurrCd()); // accuralCommissionCurrency
                rowData.add(String.valueOf(detl.getCollPldgMrktVal().getValue())); // pledgedCollateralvalue
                rowData.add(detl.getCollPldgMrktVal().getIsoCurrCd()); // pledgedCollateralCurrency
                rowData.add(String.valueOf(detl.getCollPldgFeeRate())); // pledgedCollateralFee
                rowData.add(String.valueOf(detl.getCollPldgCurntCommissAmnt().getValue())); // pledged CollateralCurrent Amount
                rowData.add(detl.getCollPldgCurntCommissAmnt().getIsoCurrCd()); // pledgedCollateral CurrentCurrency
                rowData.add(String.valueOf(detl.getCollPldgAccrCommissAmnt().getValue())); // pledgedCollateralAccuralAmount
                rowData.add(detl.getCollPldgAccrCommissAmnt().getIsoCurrCd()); // pledgedCollateralAccuralCurrency
                rowData.add(detl.getCurntCommissStartDt()); // comissionStartDate
                rowData.add(detl.getCurntCommissEndDt()); // comissionEndDate
                rowData.add(secLendCommissRep.getAcct().getAcctId()); // settlement Depot ID
                rowData.add(secLendCommissRep.getAcct().getAcctNm()); // settlement DepotAccount
                rowData.add(""); // Root Cause (empty as not in XML)
                rowData.add(""); // Commentary (empty as not in XML)
                rowData.add("AUTO BORROW"); // Message Type (hardcoded)

                writer.write(String.join("|", rowData) + "\n");
            }
        }
    }

    private SecLendCommissRep loadXmlDocument() throws Exception {
        JAXBContext jaxbContext = JAXBContext.newInstance(SecLendCommissRep.class);
        Unmarshaller unmarshaller = jaxbContext.createUnmarshaller();
        return (SecLendCommissRep) unmarshaller.unmarshal(new File(xmlFilePath));
    }

    private List<String> getHeaders() {
        List<String> headers = new ArrayList<>();
        headers.add("businessDate");
        headers.add("tradeTicket");
        headers.add("tradeTag");
        headers.add("externalTradeID");
        headers.add("activityType");
        headers.add("buyOrSell");
        headers.add("tradeDate");
        headers.add("valueDate");
        headers.add("ISIN");
        headers.add("instrumentType");
        headers.add("securityName");
        headers.add("nominalAmount");
        headers.add("netConsiderationoutstanding");
        headers.add("currency");
        headers.add("bondAccuralInterest");
        headers.add("firstCurrency");
        headers.add("SecondCurrency");
        headers.add("exchangeRate");
        headers.add("feeRate");
        headers.add("dividendCoupon");
        headers.add("handlingFee");
        headers.add("handlingCurrency");
        headers.add("commissionAmount");
        headers.add("commissionCurrency");
        headers.add("accuralCommissionAmount");
        headers.add("accuralCommissionCurrency");
        headers.add("pledgedCollateralvalue");
        headers.add("pledgedCollateralCurrency");
        headers.add("pledgedCollateralFee");
        headers.add("pledgedCollateralCurrentAmount");
        headers.add("pledgedCollateralCurrentCurrency");
        headers.add("pledgedCollateralAccuralAmount");
        headers.add("pledgedCollateralAccuralCurrency");
        headers.add("comissionStartDate");
        headers.add("comissionEndDate");
        headers.add("settlementDepotID");
        headers.add("settlementDepotAccount");
        headers.add("RootCause");
        headers.add("Commentary");
        headers.add("MessageType");
        return headers;
    }
}



private List<List<Object>> getHeaderMetadata() {
    List<List<Object>> headerMetadata = new ArrayList<>();

    headerMetadata.add(List.of("String", "businessDate", true, "", "", true));
    headerMetadata.add(List.of("String", "tradeTicket", true, "", "", true));
    headerMetadata.add(List.of("String", "tradeTag", true, "", "", true));
    headerMetadata.add(List.of("String", "externalTradeID", true, "", "", true));
    headerMetadata.add(List.of("String", "activityType", true, "", "", true));
    headerMetadata.add(List.of("String", "buyOrSell", true, "", "", true));
    headerMetadata.add(List.of("String", "tradeDate", true, "", "", true));
    headerMetadata.add(List.of("String", "valueDate", true, "", "", true));
    headerMetadata.add(List.of("String", "ISIN", true, "", "", true));
    headerMetadata.add(List.of("String", "instrumentType", true, "", "", true));
    headerMetadata.add(List.of("String", "securityName", true, "", "", true));
    headerMetadata.add(List.of("Double", "nominalAmount", true, "", "", true));
    headerMetadata.add(List.of("Double", "netConsiderationoutstanding", true, "", "", true));
    headerMetadata.add(List.of("String", "currency", true, "", "", true));
    headerMetadata.add(List.of("Double", "bondAccuralInterest", true, "", "", true));
    headerMetadata.add(List.of("String", "firstCurrency", true, "", "", true));
    headerMetadata.add(List.of("String", "SecondCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "exchangeRate", true, "", "", true));
    headerMetadata.add(List.of("Double", "feeRate", true, "", "", true));
    headerMetadata.add(List.of("Double", "dividendCoupon", true, "", "", true));
    headerMetadata.add(List.of("Double", "handlingFee", true, "", "", true));
    headerMetadata.add(List.of("String", "handlingCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "commissionAmount", true, "", "", true));
    headerMetadata.add(List.of("String", "commissionCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "accuralCommissionAmount", true, "", "", true));
    headerMetadata.add(List.of("String", "accuralCommissionCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "pledgedCollateralvalue", true, "", "", true));
    headerMetadata.add(List.of("String", "pledgedCollateralCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "pledgedCollateralFee", true, "", "", true));
    headerMetadata.add(List.of("Double", "pledgedCollateralCurrentAmount", true, "", "", true));
    headerMetadata.add(List.of("String", "pledgedCollateralCurrentCurrency", true, "", "", true));
    headerMetadata.add(List.of("Double", "pledgedCollateralAccuralAmount", true, "", "", true));
    headerMetadata.add(List.of("String", "pledgedCollateralAccuralCurrency", true, "", "", true));
    headerMetadata.add(List.of("String", "comissionStartDate", true, "", "", true));
    headerMetadata.add(List.of("String", "comissionEndDate", true, "", "", true));
    headerMetadata.add(List.of("String", "settlementDepotID", true, "", "", true));
    headerMetadata.add(List.of("String", "settlementDepotAccount", true, "", "", true));
    headerMetadata.add(List.of("String", "RootCause", true, "", "", true));
    headerMetadata.add(List.of("String", "Commentary", true, "", "", true));
    headerMetadata.add(List.of("String", "MessageType", true, "", "", true));

    return headerMetadata;
}

import org.json.JSONArray;
import org.json.JSONObject;

private JSONObject getHeaderMetadata() {
    JSONObject metadata = new JSONObject();

    JSONArray headers = new JSONArray();
    
    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "businessDate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "tradeTicket")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "tradeTag")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "externalTradeID")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "activityType")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "buyOrSell")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "tradeDate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "valueDate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "ISIN")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "instrumentType")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "securityName")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "nominalAmount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "netConsiderationoutstanding")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "currency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "bondAccuralInterest")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "firstCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "SecondCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "exchangeRate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "feeRate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "dividendCoupon")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "handlingFee")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "handlingCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "commissionAmount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "commissionCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "accuralCommissionAmount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "accuralCommissionCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "pledgedCollateralvalue")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "pledgedCollateralCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "pledgedCollateralFee")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "pledgedCollateralCurrentAmount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "pledgedCollateralCurrentCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "Double")
        .put("displayName", "pledgedCollateralAccuralAmount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "pledgedCollateralAccuralCurrency")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "comissionStartDate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "comissionEndDate")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "settlementDepotID")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "settlementDepotAccount")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "RootCause")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "Commentary")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    headers.put(new JSONObject()
        .put("dataType", "String")
        .put("displayName", "MessageType")
        .put("filter", true)
        .put("sourceFormat", "")
        .put("displayFormat", "")
        .put("exceptionDetailScreen", true));

    metadata.put("headers", headers);

    return metadata;
}


import com.google.gson.JsonObject;

private JsonObject getStructuredMetadata() {
    JsonObject metadata = new JsonObject();
    JsonObject fields = new JsonObject();

    // Example for each header field with the structure provided

    // businessDate
    JsonObject businessDate = new JsonObject();
    businessDate.addProperty("dataType", "String");
    businessDate.addProperty("position", 1);
    businessDate.addProperty("displayName", "Business Date");
    businessDate.addProperty("sourceFormat", "");
    businessDate.addProperty("displayFormat", "");
    businessDate.addProperty("filter", true);
    businessDate.addProperty("exceptionDetailscreen", true);
    businessDate.addProperty("displayAttribute", true);
    fields.add("businessDate", businessDate);

    // tradeTicket
    JsonObject tradeTicket = new JsonObject();
    tradeTicket.addProperty("dataType", "String");
    tradeTicket.addProperty("position", 2);
    tradeTicket.addProperty("displayName", "Trade Ticket");
    tradeTicket.addProperty("sourceFormat", "");
    tradeTicket.addProperty("displayFormat", "");
    tradeTicket.addProperty("filter", true);
    tradeTicket.addProperty("exceptionDetailscreen", true);
    tradeTicket.addProperty("displayAttribute", true);
    fields.add("tradeTicket", tradeTicket);

    // tradeTag
    JsonObject tradeTag = new JsonObject();
    tradeTag.addProperty("dataType", "String");
    tradeTag.addProperty("position", 3);
    tradeTag.addProperty("displayName", "Trade Tag");
    tradeTag.addProperty("sourceFormat", "");
    tradeTag.addProperty("displayFormat", "");
    tradeTag.addProperty("filter", true);
    tradeTag.addProperty("exceptionDetailscreen", true);
    tradeTag.addProperty("displayAttribute", true);
    fields.add("tradeTag", tradeTag);

    // externalTradeID
    JsonObject externalTradeID = new JsonObject();
    externalTradeID.addProperty("dataType", "String");
    externalTradeID.addProperty("position", 4);
    externalTradeID.addProperty("displayName", "External Trade ID");
    externalTradeID.addProperty("sourceFormat", "");
    externalTradeID.addProperty("displayFormat", "");
    externalTradeID.addProperty("filter", true);
    externalTradeID.addProperty("exceptionDetailscreen", true);
    externalTradeID.addProperty("displayAttribute", true);
    fields.add("externalTradeID", externalTradeID);

    // activityType
    JsonObject activityType = new JsonObject();
    activityType.addProperty("dataType", "String");
    activityType.addProperty("position", 5);
    activityType.addProperty("displayName", "Activity Type");
    activityType.addProperty("sourceFormat", "");
    activityType.addProperty("displayFormat", "");
    activityType.addProperty("filter", true);
    activityType.addProperty("exceptionDetailscreen", true);
    activityType.addProperty("displayAttribute", true);
    fields.add("activityType", activityType);

    // buyOrSell
    JsonObject buyOrSell = new JsonObject();
    buyOrSell.addProperty("dataType", "String");
    buyOrSell.addProperty("position", 6);
    buyOrSell.addProperty("displayName", "Buy or Sell");
    buyOrSell.addProperty("sourceFormat", "");
    buyOrSell.addProperty("displayFormat", "");
    buyOrSell.addProperty("filter", true);
    buyOrSell.addProperty("exceptionDetailscreen", true);
    buyOrSell.addProperty("displayAttribute", true);
    fields.add("buyOrSell", buyOrSell);

    // tradeDate
    JsonObject tradeDate = new JsonObject();
    tradeDate.addProperty("dataType", "String");
    tradeDate.addProperty("position", 7);
    tradeDate.addProperty("displayName", "Trade Date");
    tradeDate.addProperty("sourceFormat", "");
    tradeDate.addProperty("displayFormat", "");
    tradeDate.addProperty("filter", true);
    tradeDate.addProperty("exceptionDetailscreen", true);
    tradeDate.addProperty("displayAttribute", true);
    fields.add("tradeDate", tradeDate);

    // valueDate
    JsonObject valueDate = new JsonObject();
    valueDate.addProperty("dataType", "String");
    valueDate.addProperty("position", 8);
    valueDate.addProperty("displayName", "Value Date");
    valueDate.addProperty("sourceFormat", "");
    valueDate.addProperty("displayFormat", "");
    valueDate.addProperty("filter", true);
    valueDate.addProperty("exceptionDetailscreen", true);
    valueDate.addProperty("displayAttribute", true);
    fields.add("valueDate", valueDate);

    // ISIN
    JsonObject ISIN = new JsonObject();
    ISIN.addProperty("dataType", "String");
    ISIN.addProperty("position", 9);
    ISIN.addProperty("displayName", "ISIN");
    ISIN.addProperty("sourceFormat", "");
    ISIN.addProperty("displayFormat", "");
    ISIN.addProperty("filter", true);
    ISIN.addProperty("exceptionDetailscreen", true);
    ISIN.addProperty("displayAttribute", true);
    fields.add("ISIN", ISIN);

    // instrumentType
    JsonObject instrumentType = new JsonObject();
    instrumentType.addProperty("dataType", "String");
    instrumentType.addProperty("position", 10);
    instrumentType.addProperty("displayName", "Instrument Type");
    instrumentType.addProperty("sourceFormat", "");
    instrumentType.addProperty("displayFormat", "");
    instrumentType.addProperty("filter", true);
    instrumentType.addProperty("exceptionDetailscreen", true);
    instrumentType.addProperty("displayAttribute", true);
    fields.add("instrumentType", instrumentType);

    // securityName
    JsonObject securityName = new JsonObject();
    securityName.addProperty("dataType", "String");
    securityName.addProperty("position", 11);
    securityName.addProperty("displayName", "Security Name");
    securityName.addProperty("sourceFormat", "");
    securityName.addProperty("displayFormat", "");
    securityName.addProperty("filter", true);
    securityName.addProperty("exceptionDetailscreen", true);
    securityName.addProperty("displayAttribute", true);
    fields.add("securityName", securityName);

    // nominalAmount
    JsonObject nominalAmount = new JsonObject();
    nominalAmount.addProperty("dataType", "String");
    nominalAmount.addProperty("position", 12);
    nominalAmount.addProperty("displayName", "Nominal Amount");
    nominalAmount.addProperty("sourceFormat", "");
    nominalAmount.addProperty("displayFormat", "");
    nominalAmount.addProperty("filter", true);
    nominalAmount.addProperty("exceptionDetailscreen", true);
    nominalAmount.addProperty("displayAttribute", true);
    fields.add("nominalAmount", nominalAmount);

    // Add the remaining fields following the same pattern...

    // Attach fields to metadata
    metadata.add("fields", fields);

    return metadata;
}


import com.google.gson.JsonObject;

private JsonObject getStructuredMetadata() {
    JsonObject metadata = new JsonObject();
    JsonObject fields = new JsonObject();

    // Continue adding fields after the ones previously shown

    // netConsiderationoutstanding
    JsonObject netConsiderationoutstanding = new JsonObject();
    netConsiderationoutstanding.addProperty("dataType", "String");
    netConsiderationoutstanding.addProperty("position", 13);
    netConsiderationoutstanding.addProperty("displayName", "Net Consideration Outstanding");
    netConsiderationoutstanding.addProperty("sourceFormat", "");
    netConsiderationoutstanding.addProperty("displayFormat", "");
    netConsiderationoutstanding.addProperty("filter", true);
    netConsiderationoutstanding.addProperty("exceptionDetailscreen", true);
    netConsiderationoutstanding.addProperty("displayAttribute", true);
    fields.add("netConsiderationoutstanding", netConsiderationoutstanding);

    // currency
    JsonObject currency = new JsonObject();
    currency.addProperty("dataType", "String");
    currency.addProperty("position", 14);
    currency.addProperty("displayName", "Currency");
    currency.addProperty("sourceFormat", "");
    currency.addProperty("displayFormat", "");
    currency.addProperty("filter", true);
    currency.addProperty("exceptionDetailscreen", true);
    currency.addProperty("displayAttribute", true);
    fields.add("currency", currency);

    // bondAccuralInterest
    JsonObject bondAccuralInterest = new JsonObject();
    bondAccuralInterest.addProperty("dataType", "String");
    bondAccuralInterest.addProperty("position", 15);
    bondAccuralInterest.addProperty("displayName", "Bond Accrual Interest");
    bondAccuralInterest.addProperty("sourceFormat", "");
    bondAccuralInterest.addProperty("displayFormat", "");
    bondAccuralInterest.addProperty("filter", true);
    bondAccuralInterest.addProperty("exceptionDetailscreen", true);
    bondAccuralInterest.addProperty("displayAttribute", true);
    fields.add("bondAccuralInterest", bondAccuralInterest);

    // firstCurrency
    JsonObject firstCurrency = new JsonObject();
    firstCurrency.addProperty("dataType", "String");
    firstCurrency.addProperty("position", 16);
    firstCurrency.addProperty("displayName", "First Currency");
    firstCurrency.addProperty("sourceFormat", "");
    firstCurrency.addProperty("displayFormat", "");
    firstCurrency.addProperty("filter", true);
    firstCurrency.addProperty("exceptionDetailscreen", true);
    firstCurrency.addProperty("displayAttribute", true);
    fields.add("firstCurrency", firstCurrency);

    // SecondCurrency
    JsonObject SecondCurrency = new JsonObject();
    SecondCurrency.addProperty("dataType", "String");
    SecondCurrency.addProperty("position", 17);
    SecondCurrency.addProperty("displayName", "Second Currency");
    SecondCurrency.addProperty("sourceFormat", "");
    SecondCurrency.addProperty("displayFormat", "");
    SecondCurrency.addProperty("filter", true);
    SecondCurrency.addProperty("exceptionDetailscreen", true);
    SecondCurrency.addProperty("displayAttribute", true);
    fields.add("SecondCurrency", SecondCurrency);

    // exchangeRate
    JsonObject exchangeRate = new JsonObject();
    exchangeRate.addProperty("dataType", "String");
    exchangeRate.addProperty("position", 18);
    exchangeRate.addProperty("displayName", "Exchange Rate");
    exchangeRate.addProperty("sourceFormat", "");
    exchangeRate.addProperty("displayFormat", "");
    exchangeRate.addProperty("filter", true);
    exchangeRate.addProperty("exceptionDetailscreen", true);
    exchangeRate.addProperty("displayAttribute", true);
    fields.add("exchangeRate", exchangeRate);

    // feeRate
    JsonObject feeRate = new JsonObject();
    feeRate.addProperty("dataType", "String");
    feeRate.addProperty("position", 19);
    feeRate.addProperty("displayName", "Fee Rate");
    feeRate.addProperty("sourceFormat", "");
    feeRate.addProperty("displayFormat", "");
    feeRate.addProperty("filter", true);
    feeRate.addProperty("exceptionDetailscreen", true);
    feeRate.addProperty("displayAttribute", true);
    fields.add("feeRate", feeRate);

    // dividendCoupon
    JsonObject dividendCoupon = new JsonObject();
    dividendCoupon.addProperty("dataType", "String");
    dividendCoupon.addProperty("position", 20);
    dividendCoupon.addProperty("displayName", "Dividend Coupon");
    dividendCoupon.addProperty("sourceFormat", "");
    dividendCoupon.addProperty("displayFormat", "");
    dividendCoupon.addProperty("filter", true);
    dividendCoupon.addProperty("exceptionDetailscreen", true);
    dividendCoupon.addProperty("displayAttribute", true);
    fields.add("dividendCoupon", dividendCoupon);

    // handlingFee
    JsonObject handlingFee = new JsonObject();
    handlingFee.addProperty("dataType", "String");
    handlingFee.addProperty("position", 21);
    handlingFee.addProperty("displayName", "Handling Fee");
    handlingFee.addProperty("sourceFormat", "");
    handlingFee.addProperty("displayFormat", "");
    handlingFee.addProperty("filter", true);
    handlingFee.addProperty("exceptionDetailscreen", true);
    handlingFee.addProperty("displayAttribute", true);
    fields.add("handlingFee", handlingFee);

    // handlingCurrency
    JsonObject handlingCurrency = new JsonObject();
    handlingCurrency.addProperty("dataType", "String");
    handlingCurrency.addProperty("position", 22);
    handlingCurrency.addProperty("displayName", "Handling Currency");
    handlingCurrency.addProperty("sourceFormat", "");
    handlingCurrency.addProperty("displayFormat", "");
    handlingCurrency.addProperty("filter", true);
    handlingCurrency.addProperty("exceptionDetailscreen", true);
    handlingCurrency.addProperty("displayAttribute", true);
    fields.add("handlingCurrency", handlingCurrency);

    // commissionAmount
    JsonObject commissionAmount = new JsonObject();
    commissionAmount.addProperty("dataType", "String");
    commissionAmount.addProperty("position", 23);
    commissionAmount.addProperty("displayName", "Commission Amount");
    commissionAmount.addProperty("sourceFormat", "");
    commissionAmount.addProperty("displayFormat", "");
    commissionAmount.addProperty("filter", true);
    commissionAmount.addProperty("exceptionDetailscreen", true);
    commissionAmount.addProperty("displayAttribute", true);
    fields.add("commissionAmount", commissionAmount);

    // commissionCurrency
    JsonObject commissionCurrency = new JsonObject();
    commissionCurrency.addProperty("dataType", "String");
    commissionCurrency.addProperty("position", 24);
    commissionCurrency.addProperty("displayName", "Commission Currency");
    commissionCurrency.addProperty("sourceFormat", "");
    commissionCurrency.addProperty("displayFormat", "");
    commissionCurrency.addProperty("filter", true);
    commissionCurrency.addProperty("exceptionDetailscreen", true);
    commissionCurrency.addProperty("displayAttribute", true);
    fields.add("commissionCurrency", commissionCurrency);

    // accuralCommissionAmount
    JsonObject accuralCommissionAmount = new JsonObject();
    accuralCommissionAmount.addProperty("dataType", "String");
    accuralCommissionAmount.addProperty("position", 25);
    accuralCommissionAmount.addProperty("displayName", "Accrual Commission Amount");
    accuralCommissionAmount.addProperty("sourceFormat", "");
    accuralCommissionAmount.addProperty("displayFormat", "");
    accuralCommissionAmount.addProperty("filter", true);
    accuralCommissionAmount.addProperty("exceptionDetailscreen", true);
    accuralCommissionAmount.addProperty("displayAttribute", true);
    fields.add("accuralCommissionAmount", accuralCommissionAmount);

    // accuralCommissionCurrency
    JsonObject accuralCommissionCurrency = new JsonObject();
    accuralCommissionCurrency.addProperty("dataType", "String");
    accuralCommissionCurrency.addProperty("position", 26);
    accuralCommissionCurrency.addProperty("displayName", "Accrual Commission Currency");
    accuralCommissionCurrency.addProperty("sourceFormat", "");
    accuralCommissionCurrency.addProperty("displayFormat", "");
    accuralCommissionCurrency.addProperty("filter", true);
    accuralCommissionCurrency.addProperty("exceptionDetailscreen", true);
    accuralCommissionCurrency.addProperty("displayAttribute", true);
    fields.add("accuralCommissionCurrency", accuralCommissionCurrency);

    // pledgedCollateralvalue
    JsonObject pledgedCollateralvalue = new JsonObject();
    pledgedCollateralvalue.addProperty("dataType", "String");
    pledgedCollateralvalue.addProperty("position", 27);
    pledgedCollateralvalue.addProperty("displayName", "Pledged Collateral Value");
    pledgedCollateralvalue.addProperty("sourceFormat", "");
    pledgedCollateralvalue.addProperty("displayFormat", "");
    pledgedCollateralvalue.addProperty("filter", true);
    pledgedCollateralvalue.addProperty("exceptionDetailscreen", true);
    pledgedCollateralvalue.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralvalue", pledgedCollateralvalue);

    // pledgedCollateralCurrency
    JsonObject pledgedCollateralCurrency = new JsonObject();
    pledgedCollateralCurrency.addProperty("dataType", "String");
    pledgedCollateralCurrency.addProperty("position", 28);
    pledgedCollateralCurrency.addProperty("displayName", "Pledged Collateral Currency");
    pledgedCollateralCurrency.addProperty("sourceFormat", "");
    pledgedCollateralCurrency.addProperty("displayFormat", "");
    pledgedCollateralCurrency.addProperty("filter", true);
    pledgedCollateralCurrency.addProperty("exceptionDetailscreen", true);
    pledgedCollateralCurrency.addProperty("dis

// pledgedCollateralCurrency
    JsonObject pledgedCollateralCurrency = new JsonObject();
    pledgedCollateralCurrency.addProperty("dataType", "String");
    pledgedCollateralCurrency.addProperty("position", 28);
    pledgedCollateralCurrency.addProperty("displayName", "Pledged Collateral Currency");
    pledgedCollateralCurrency.addProperty("sourceFormat", "");
    pledgedCollateralCurrency.addProperty("displayFormat", "");
    pledgedCollateralCurrency.addProperty("filter", true);
    pledgedCollateralCurrency.addProperty("exceptionDetailscreen", true);
    pledgedCollateralCurrency.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralCurrency", pledgedCollateralCurrency);

    // pledgedCollateralFee
    JsonObject pledgedCollateralFee = new JsonObject();
    pledgedCollateralFee.addProperty("dataType", "String");
    pledgedCollateralFee.addProperty("position", 29);
    pledgedCollateralFee.addProperty("displayName", "Pledged Collateral Fee");
    pledgedCollateralFee.addProperty("sourceFormat", "");
    pledgedCollateralFee.addProperty("displayFormat", "");
    pledgedCollateralFee.addProperty("filter", true);
    pledgedCollateralFee.addProperty("exceptionDetailscreen", true);
    pledgedCollateralFee.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralFee", pledgedCollateralFee);

    // pledgedCollateralCurrentAmount
    JsonObject pledgedCollateralCurrentAmount = new JsonObject();
    pledgedCollateralCurrentAmount.addProperty("dataType", "String");
    pledgedCollateralCurrentAmount.addProperty("position", 30);
    pledgedCollateralCurrentAmount.addProperty("displayName", "Pledged Collateral Current Amount");
    pledgedCollateralCurrentAmount.addProperty("sourceFormat", "");
    pledgedCollateralCurrentAmount.addProperty("displayFormat", "");
    pledgedCollateralCurrentAmount.addProperty("filter", true);
    pledgedCollateralCurrentAmount.addProperty("exceptionDetailscreen", true);
    pledgedCollateralCurrentAmount.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralCurrentAmount", pledgedCollateralCurrentAmount);

    // pledgedCollateralCurrentCurrency
    JsonObject pledgedCollateralCurrentCurrency = new JsonObject();
    pledgedCollateralCurrentCurrency.addProperty("dataType", "String");
    pledgedCollateralCurrentCurrency.addProperty("position", 31);
    pledgedCollateralCurrentCurrency.addProperty("displayName", "Pledged Collateral Current Currency");
    pledgedCollateralCurrentCurrency.addProperty("sourceFormat", "");
    pledgedCollateralCurrentCurrency.addProperty("displayFormat", "");
    pledgedCollateralCurrentCurrency.addProperty("filter", true);
    pledgedCollateralCurrentCurrency.addProperty("exceptionDetailscreen", true);
    pledgedCollateralCurrentCurrency.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralCurrentCurrency", pledgedCollateralCurrentCurrency);

    // pledgedCollateralAccrualAmount
    JsonObject pledgedCollateralAccrualAmount = new JsonObject();
    pledgedCollateralAccrualAmount.addProperty("dataType", "String");
    pledgedCollateralAccrualAmount.addProperty("position", 32);
    pledgedCollateralAccrualAmount.addProperty("displayName", "Pledged Collateral Accrual Amount");
    pledgedCollateralAccrualAmount.addProperty("sourceFormat", "");
    pledgedCollateralAccrualAmount.addProperty("displayFormat", "");
    pledgedCollateralAccrualAmount.addProperty("filter", true);
    pledgedCollateralAccrualAmount.addProperty("exceptionDetailscreen", true);
    pledgedCollateralAccrualAmount.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralAccrualAmount", pledgedCollateralAccrualAmount);

    // pledgedCollateralAccrualCurrency
    JsonObject pledgedCollateralAccrualCurrency = new JsonObject();
    pledgedCollateralAccrualCurrency.addProperty("dataType", "String");
    pledgedCollateralAccrualCurrency.addProperty("position", 33);
    pledgedCollateralAccrualCurrency.addProperty("displayName", "Pledged Collateral Accrual Currency");
    pledgedCollateralAccrualCurrency.addProperty("sourceFormat", "");
    pledgedCollateralAccrualCurrency.addProperty("displayFormat", "");
    pledgedCollateralAccrualCurrency.addProperty("filter", true);
    pledgedCollateralAccrualCurrency.addProperty("exceptionDetailscreen", true);
    pledgedCollateralAccrualCurrency.addProperty("displayAttribute", true);
    fields.add("pledgedCollateralAccrualCurrency", pledgedCollateralAccrualCurrency);

    // comissionStartDate
    JsonObject comissionStartDate = new JsonObject();
    comissionStartDate.addProperty("dataType", "String");
    comissionStartDate.addProperty("position", 34);
    comissionStartDate.addProperty("displayName", "Commission Start Date");
    comissionStartDate.addProperty("sourceFormat", "");
    comissionStartDate.addProperty("displayFormat", "");
    comissionStartDate.addProperty("filter", true);
    comissionStartDate.addProperty("exceptionDetailscreen", true);
    comissionStartDate.addProperty("displayAttribute", true);
    fields.add("comissionStartDate", comissionStartDate);

    // comissionEndDate
    JsonObject comissionEndDate = new JsonObject();
    comissionEndDate.addProperty("dataType", "String");
    comissionEndDate.addProperty("position", 35);
    comissionEndDate.addProperty("displayName", "Commission End Date");
    comissionEndDate.addProperty("sourceFormat", "");
    comissionEndDate.addProperty("displayFormat", "");
    comissionEndDate.addProperty("filter", true);
    comissionEndDate.addProperty("exceptionDetailscreen", true);
    comissionEndDate.addProperty("displayAttribute", true);
    fields.add("comissionEndDate", comissionEndDate);

    // settlementDepotID
    JsonObject settlementDepotID = new JsonObject();
    settlementDepotID.addProperty("dataType", "String");
    settlementDepotID.addProperty("position", 36);
    settlementDepotID.addProperty("displayName", "Settlement Depot ID");
    settlementDepotID.addProperty("sourceFormat", "");
    settlementDepotID.addProperty("displayFormat", "");
    settlementDepotID.addProperty("filter", true);
    settlementDepotID.addProperty("exceptionDetailscreen", true);
    settlementDepotID.addProperty("displayAttribute", true);
    fields.add("settlementDepotID", settlementDepotID);

    // settlementDepotAccount
    JsonObject settlementDepotAccount = new JsonObject();
    settlementDepotAccount.addProperty("dataType", "String");
    settlementDepotAccount.addProperty("position", 37);
    settlementDepotAccount.addProperty("displayName", "Settlement Depot Account");
    settlementDepotAccount.addProperty("sourceFormat", "");
    settlementDepotAccount.addProperty("displayFormat", "");
    settlementDepotAccount.addProperty("filter", true);
    settlementDepotAccount.addProperty("exceptionDetailscreen", true);
    settlementDepotAccount.addProperty("displayAttribute", true);
    fields.add("settlementDepotAccount", settlementDepotAccount);

    // RootCause
    JsonObject RootCause = new JsonObject();
    RootCause.addProperty("dataType", "String");
    RootCause.addProperty("position", 38);
    RootCause.addProperty("displayName", "Root Cause");
    RootCause.addProperty("sourceFormat", "");
    RootCause.addProperty("displayFormat", "");
    RootCause.addProperty("filter", true);
    RootCause.addProperty("exceptionDetailscreen", true);
    RootCause.addProperty("displayAttribute", true);
    fields.add("RootCause", RootCause);

    // Commentary
    JsonObject Commentary = new JsonObject();
    Commentary.addProperty("dataType", "String");
    Commentary.addProperty("position", 39);
    Commentary.addProperty("displayName", "Commentary");
    Commentary.addProperty("sourceFormat", "");
    Commentary.addProperty("displayFormat", "");
    Commentary.addProperty("filter", true);
    Commentary.addProperty("exceptionDetailscreen", true);
    Commentary.addProperty("displayAttribute", true);
    fields.add("Commentary", Commentary);

    // MessageType
    JsonObject MessageType = new JsonObject();
    MessageType.addProperty("dataType", "String");
    MessageType.addProperty("position", 40);
    MessageType.addProperty("displayName", "Message Type");
    MessageType.addProperty("sourceFormat", "");
    MessageType.addProperty("displayFormat", "");
    MessageType.addProperty("filter", true);
    MessageType.addProperty("exceptionDetailscreen", true);
    MessageType.addProperty("displayAttribute", true);
    fields.add("MessageType", MessageType);

    // Attach fields to metadata
    metadata.add("fields", fields);

    return metadata;
}
