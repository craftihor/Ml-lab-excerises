import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.bson.BasicDBObject;

public class AutoborrowCalculationTest {

    private AutoborrowCalculation calculation = new AutoborrowCalculation();

    @Test
    void testCalculate() {
        // Prepare input data
        List<TradeVO> trades = new ArrayList<>();
        TradeVO trade = new TradeVO();
        trade.setData(new BasicDBObject("tradeDate", "Jan 1, 2022 12:00:00 PM EST"));
        trade.setData(new BasicDBObject("tradingType", "AUTO BORROW"));
        trades.add(trade);

        // Execute calculation
        List<TradeVO> result = calculation.calculate(trades);

        // Verify results
        assertNotNull(result);
        assertEquals(1, result.size());
        TradeVO tradeVO = result.get(0);
        BasicDBObject data = tradeVO.getData();
        assertNotNull(data.get("autoborrowAge"));
        assertEquals("AUTOBORROW", data.get("trdCategory"));
    }

    @Test
    void testUpdateAge_ValidDate() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject("tradeDate", "Jan 1, 2022 12:00:00 PM EST");

        // Execute update age
        BasicDBObject result = calculation.updateAge(data);

        // Verify results
        assertNotNull(result);
        assertNotNull(result.get("autoborrowAge"));
    }

    @Test
    void testUpdateAge_InvalidDate() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject("tradeDate", "INVALID_DATE");

        // Execute update age
        BasicDBObject result = calculation.updateAge(data);

        // Verify results
        assertNotNull(result);
        assertEquals(null, result.get("autoborrowAge"));
    }

    @Test
    void testUpdateAge_MissingTradeDate() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject();

        // Execute update age
        BasicDBObject result = calculation.updateAge(data);

        // Verify results
        assertNotNull(result);
        assertEquals(null, result.get("autoborrowAge"));
    }

    @Test
    void testUpdateTrdCategory_ValidType() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject("tradingType", "AUTO BORROW");

        // Execute update trade category
        BasicDBObject result = calculation.updatetrdCategory(data);

        // Verify results
        assertNotNull(result);
        assertEquals("AUTOBORROW", result.get("trdCategory"));
    }

    @Test
    void testUpdateTrdCategory_InvalidType() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject("tradingType", "INVALID_TYPE");

        // Execute update trade category
        BasicDBObject result = calculation.updatetrdCategory(data);

        // Verify results
        assertNotNull(result);
        assertEquals(null, result.get("trdCategory"));
    }

    @Test
    void testUpdateTrdCategory_MissingTradingType() {
        // Prepare input data
        BasicDBObject data = new BasicDBObject();

        // Execute update trade category
        BasicDBObject result = calculation.updatetrdCategory(data);

        // Verify results
        assertNotNull(result);
        assertEquals(null, result.get("trdCategory"));
    }

    @Test
    void testParseDate_ValidDate() {
        // Prepare input data
        String dateString = "Jan 1, 2022 12:00:00 PM EST";

        // Execute parse date
        Date result = calculation.parseDate(dateString);

        // Verify results
        assertNotNull(result);
    }

    @Test
    void testParseDate_InvalidDate() {
        // Prepare input data
        String dateString = "INVALID_DATE";

        // Execute parse date
        assertThrows(ParseException.class, () -> calculation.parseDate(dateString));
    }
}
